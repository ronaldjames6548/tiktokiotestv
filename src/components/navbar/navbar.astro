---
import { getLangFromUrl, useTranslations } from "../../i18n/utils";
import { getRelativeLocaleUrl } from "astro:i18n";
import { Icon } from "astro-icon/components";
import LanguageSelector from "@components/languageselector.astro";

const safeUrl = Astro.url || new URL('/', Astro.site || 'http://localhost:4321');
const lang = getLangFromUrl(safeUrl);
const t = useTranslations(lang);

function localizePath(path: string) {
	if (!path || (path && path.startsWith('http')) || path === '#') return path;
	return getRelativeLocaleUrl(lang, path);
}
---

<div class="top-0 py-1 lg:py-2 w-full bg-transparent lg:relative z-50 dark:bg-gray-900" x-data="{ mobileMenuOpen: false }">
    <nav class="z-10 sticky top-0 left-0 right-0 max-w-7xl xl:max-w-7xl mx-auto px-5 py-2.5 lg:border-none lg:py-4">
        <div class="flex items-center justify-between">
            <a 
                href={localizePath("/")} 
                class="flex items-center text-2xl font-bold tracking-widest text-gray-900 rounded-lg dark:text-white focus:outline-none focus:shadow-outline" 
                aria-label="Tiktokio"
            >
                <Icon name="logo" width={30} class="dark:invert" />
                Tiktokio
            </a>

            <!-- Desktop Menu -->
            <div class="hidden lg:block">
                <ul class="flex space-x-10 text-base font-bold text-black/60 dark:text-white">
                    <li class="hover:underline hover:underline-offset-4 hover:w-fit transition-all duration-100 ease-linear">
                        <a href={localizePath("/musically-down")} aria-label={t("header.nav_3")}>
                            {t("header.nav_3")}
                        </a>
                    </li>
                    <li class="hover:underline hover:underline-offset-4 hover:w-fit transition-all duration-100 ease-linear">
                        <a href={localizePath("/")} aria-label={t("header.nav_1")}>
                            {t("header.nav_1")}
                        </a>
                    </li>
                    <li class="hover:underline hover:underline-offset-4 hover:w-fit transition-all duration-100 ease-linear">
                        <a href={localizePath("/savetik-downloader-download-tiktok-videos-without-watermark")} aria-label={t("header.nav_4")}>
                            {t("header.nav_4")}
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Language Selector (Desktop) -->
            <div class="hidden lg:flex lg:items-center gap-x-2">
                <LanguageSelector showFlag={true} class="appearance-none py-1 px-2 rounded bg-slate-100"/>
            </div>

            <!-- Mobile Menu Button -->
            <div class="flex items-center justify-center lg:hidden">
                <button 
                    @click="mobileMenuOpen = !mobileMenuOpen"
                    class="focus:outline-none text-slate-200 dark:text-white"
                    aria-label="Toggle mobile menu"
                    aria-expanded="false"
                    x-bind:aria-expanded="mobileMenuOpen"
                >
                    <svg 
                        stroke="currentColor" 
                        fill="currentColor" 
                        stroke-width="0" 
                        viewBox="0 0 20 20" 
                        aria-hidden="true" 
                        class="text-2xl text-slate-800 dark:text-white focus:outline-none active:scale-110 active:text-red-500" 
                        height="1em" 
                        width="1em" 
                        xmlns="http://www.w3.org/2000/svg"
                        x-show="!mobileMenuOpen"
                    >
                        <path fill-rule="evenodd" d="M3 5a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM3 10a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zM9 15a1 1 0 011-1h6a1 1 0 110 2h-6a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                    </svg>
                    <!-- Close Icon -->
                    <svg 
                        xmlns="http://www.w3.org/2000/svg" 
                        fill="none" 
                        viewBox="0 0 24 24" 
                        stroke-width="2" 
                        stroke="currentColor" 
                        class="text-2xl text-slate-800 dark:text-white"
                        height="1em" 
                        width="1em"
                        x-show="mobileMenuOpen"
                        x-cloak
                    >
                        <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
                    </svg>
                </button>
            </div>
        </div>

        <!-- Mobile Menu Dropdown -->
        <div 
            x-show="mobileMenuOpen"
            x-transition:enter="transition ease-out duration-200"
            x-transition:enter-start="opacity-0 transform scale-95"
            x-transition:enter-end="opacity-100 transform scale-100"
            x-transition:leave="transition ease-in duration-150"
            x-transition:leave-start="opacity-100 transform scale-100"
            x-transition:leave-end="opacity-0 transform scale-95"
            @click.away="mobileMenuOpen = false"
            class="lg:hidden mt-4"
            x-cloak
        >
            <ul class="flex flex-col space-y-4 text-base font-bold text-black/60 dark:text-white bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4">
                <li>
                    <a 
                        href={localizePath("/musically-down")} 
                        aria-label={t("header.nav_3")}
                        class="block py-2 hover:text-black dark:hover:text-white transition-colors"
                        @click="mobileMenuOpen = false"
                    >
                        {t("header.nav_3")}
                    </a>
                </li>
                <li>
                    <a 
                        href={localizePath("/")} 
                        aria-label={t("header.nav_1")}
                        class="block py-2 hover:text-black dark:hover:text-white transition-colors"
                        @click="mobileMenuOpen = false"
                    >
                        {t("header.nav_1")}
                    </a>
                </li>
                <li>
                    <a 
                        href={localizePath("/savetik-downloader-download-tiktok-videos-without-watermark")} 
                        aria-label={t("header.nav_4")}
                        class="block py-2 hover:text-black dark:hover:text-white transition-colors"
                        @click="mobileMenuOpen = false"
                    >
                        {t("header.nav_4")}
                    </a>
                </li>
                <li class="pt-2 border-t border-gray-200 dark:border-gray-700">
                    <LanguageSelector showFlag={true} class="appearance-none py-1 px-2 rounded bg-slate-100 w-full"/>
                </li>
            </ul>
        </div>
    </nav>
</div>

<style>
    [x-cloak] { 
        display: none !important; 
    }
</style>
